name: Feature Creation Pipeline

on:
  push:
    branches: [ "main" ]

jobs:
  run-feature-build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Databricks CLI (new)
        run: pip install databricks-cli

      - name: Configure Databricks CLI (manual config file)
        run: |
          mkdir -p ~/.databricks
          cat <<EOF > ~/.databricks/config
          {
            "host": "${{ secrets.DATABRICKS_HOST }}",
            "token": "${{ secrets.DATABRICKS_TOKEN }}",
            "profile": "DEFAULT"
          }
          EOF

      - name: Test Authentication
        run: databricks current-user me

      - name: Trigger Databricks Job
        run: databricks jobs run-now --job-id "${{ secrets.DATABRICKS_JOB_ID }}"
